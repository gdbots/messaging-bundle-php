<script type="text/javascript">
  var isDynamicFieldLoaded = isDynamicFieldLoaded || false;
  if (isDynamicFieldLoaded) {
      $('[data-dynamic-field={{ widgetId }}] .js-dynamic-field-kind').change();
  } else {
    var wbq = wbq || [];
    wbq.push(function initDynamicField() {
      require(
      [
        'jquery'
      ],
      function ($) {
        'use strict';

        // ignore loading twice
        if (isDynamicFieldLoaded) {
          return;
        }

        isDynamicFieldLoaded = true;

        $(document).on('change', '.js-dynamic-field-kind', function() {
          $(this).closest('.row').find('.js-dynamic-field-value-options :input:not(.js-dynamic-field-value)').hide();

          var $field = $(this).closest('.row').find('.js-dynamic-field-value-options :input[id$=_' + $(this).val() + ']');
          $field.off('change');
          $field.on('change', function() {
            $(this).closest('.js-dynamic-field-value-options')
              .find('.js-dynamic-field-value')
              .val($(this).val());
          });
          $field.show().change();
        });

        // run on load first time
        $('.js-dynamic-field-kind').change();
      });
    });
  }
</script>
